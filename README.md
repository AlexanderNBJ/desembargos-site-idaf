# Portal de Cadastro de Desembargos - IDAF

## Requisitos
- Node 	(versão recomendada: 18.x)
- npm 	(versão recomendada: 9.2.0)
- PostgreSQL (versão recomendada: 15.x)

## Preparativos

1. Instalar as dependências do Node rodando o seguinte comando na pasta `./backend`:

												`npm install`
  

2. Adicionar o arquivo `.env` na pasta `./backend`, preenchendo-o com as informações relativas ao banco de dados, à porta que a aplicação vai ser executada, a senha secreta da aplicação e a URL da API de login. Siga conforme o exemplo a seguir e o arquivo em `./backend/.env.example`
```
DB_HOST=ipDoBancoDeDados
DB_PORT=portaDoBancoDeDados
DB_NAME=nomeDaDatabase
DB_USER=usuarioDoBancoDeDados
DB_PASS=senhaDoBancoDeDados
PORT=portaDaAplicacao
SECRET=senhaSecretDaAplicacao
MAPPIA_DB_URL=urlDaAPIMappiaDB
SCHEMA=schemaNoBancoDeDados
USER_TABLE=tabelaDeUsuariosNoBancoDeDados
DESEMBARGO_TABLE=tabelaDeDesembargosNoBancoDeDados
EMBARGO_TABLE=tabelaDeEmbargosNoBancoDeDados
USER_LOG_TABLE=tabelaDeLogDeUsuarios
```

3. A estrutura utilizada (em PostgreSQL) para as tabelas no BD nos ambientes de teste foram as seguintes:

- Tabela de Usuários:

```
CREATE TABLE SCHEMA.USERS_TEST(
	ID BIGINT GENERATED ALWAYS AS IDENTITY,
	USERNAME TEXT PRIMARY KEY,
	NAME TEXT,
	POSITION TEXT,
	CREATED_AT TIMESTAMPTZ DEFAULT NOW()
);
```

- Tabela de Desembargos:

```

CREATE TABLE SCHEMA.DESEMBARGOS_TESTE(
	ID BIGINT PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	NUMERO_EMBARGO INTEGER,
	SERIE_EMBARGO CHAR,
	PROCESSO_SIMLAM TEXT,
	NUMERO_SEP BIGINT,
	NUMERO_EDOCS TEXT,
	COORDENADA_X DOUBLE PRECISION,
	COORDENADA_Y DOUBLE PRECISION,
	NOME_AUTUADO TEXT,
	AREA_DESEMBARGADA DOUBLE PRECISION,
	TIPO_DESEMBARGO TEXT CHECK(TIPO_DESEMBARGO IN('TOTAL','PARCIAL','INDEFERIMENTO')),
	DATA_DESEMBARGO DATE,
	RESPONSAVEL_DESEMBARGO TEXT NOT NULL,
	DESCRICAO TEXT,
	STATUS TEXT CHECK(STATUS IN('APROVADO','EM ANÁLISE', 'REVISÃO PENDENTE')),
	APROVADO_POR TEXT
);

```

  

- Tabela de Log de Usuários:
```
CREATE TABLE SCHEMA.LOG_TESTE(
	ID BIGINT PRIMARY KEY GENERATED ALWAYS AS IDENTITY,
	USERNAME TEXT,
	ACTION TEXT,
	DETAILS JSONB,
	IP INET,
	USER_AGENT TEXT,
	CREATED_AT TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

- Tabela de Embargos:

```
CREATE TABLE SCHEMA.EMBARGOS_TESTE(
	N_UIF_EMB INTEGER,
	NORTHING DOUBLE PRECISION,
	EASTING DOUBLE PRECISION,
	PROCESSO TEXT,
	SEP_EDOCS TEXT,
	GEOM GEOMETRY
);
```

## Execução

Para executar o backend, basta estar na pasta `./backend` e executar o seguinte comando:

												`npm start`

Note que o servidor será executado na porta definida no arquivo `.env`, e o acesso ao endereço `localhost:PORTA`, substituindo PORTA pelo valor definido no `.env`, redirecionará ao site.